---
layout: page
description: "「组一辈子乐队吧！」"
---

<!-- 添加几何图形背景CSS -->
<link rel="stylesheet" href="{{ '/css/geometry-background.css' | prepend: site.baseurl }}">

<!-- 自动刷新内容设置 -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<!-- 添加谷歌动漫风格字体 -->
<link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">

<!-- 添加分页导航样式 -->
<style>
    /* 整体背景样式 */
    body {
        background-attachment: fixed;
        position: relative;
        min-height: 100vh;
        background-image: url('https://i.loli.net/2021/09/14/5TB6poEjYqdJMQW.jpg');
        background-size: cover;
        background-position: center;
        font-family: 'Noto Sans SC', sans-serif;
    }
    
    /* 页面标题样式 */
    .navbar-brand {
        font-family: 'Mochiy Pop One', sans-serif;
        color: #ff6b97 !important;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    /* 导航菜单样式 */
    .navbar-custom {
        background-color: rgba(255, 255, 255, 0.85);
        border-bottom: 2px solid #ff6b97;
    }
    
    .navbar-custom .nav li a {
        color: #7986cb;
        transition: all 0.3s ease;
    }
    
    .navbar-custom .nav li a:hover {
        color: #ff6b97;
        transform: translateY(-2px);
    }
    
    /* 主页内容的容器 */
    .main-content-container {
        background-color: rgba(255, 255, 255, 0.85) !important;
        border-radius: 15px;
        border: 2px solid rgba(255, 182, 193, 0.6);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        box-shadow: 0 4px 15px rgba(255, 107, 151, 0.2);
        padding: 25px;
        position: relative;
        z-index: 2;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        margin-top: 20px;
    }
    
    .main-content-container:hover {
        transform: scale(1.01);
        box-shadow: 0 8px 24px rgba(255, 107, 151, 0.3);
    }
    
    /* 卡通风格装饰元素 */
    .main-content-container::before {
        content: "";
        position: absolute;
        top: -15px;
        left: 20px;
        width: 30px;
        height: 30px;
        background-color: #FF9CE3;
        border-radius: 50%;
        box-shadow: 0 0 0 5px rgba(255, 156, 227, 0.3);
        z-index: -1;
    }
    
    .main-content-container::after {
        content: "";
        position: absolute;
        bottom: -10px;
        right: 30px;
        width: 20px;
        height: 20px;
        background-color: #A7C7E7;
        border-radius: 50%;
        box-shadow: 0 0 0 4px rgba(167, 199, 231, 0.3);
        z-index: -1;
    }
    
    /* 为了让主页全屏效果更好的样式 */
    .home-spacer {
        height: 0;
        width: 100%;
        display: none;
    }
    
    /* 分页导航样式 */
    .pagination {
        display: flex;
        justify-content: center;
        margin: 30px 0;
        padding: 10px;
        list-style: none;
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 12px;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 182, 193, 0.5);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .pagination:hover {
        transform: scale(1.02);
        box-shadow: 0 5px 15px rgba(255, 107, 151, 0.2);
    }
    
    .pagination li {
        margin: 0 5px;
    }
    
    .pagination li a,
    .pagination li span {
        display: block;
        padding: 8px 16px;
        border: 1px solid rgba(255, 182, 193, 0.5);
        color: #6c5ce7;
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        background-color: rgba(255, 255, 255, 0.7);
    }
    
    .pagination li a:hover {
        background-color: #ffdbf0;
        color: #333;
        transform: translateY(-2px);
        box-shadow: 0 3px 10px rgba(255, 107, 151, 0.2);
    }
    
    .pagination li.active span {
        background-color: #ff6b97;
        color: white;
        border-color: #ff6b97;
    }
    
    .pagination li.disabled span {
        color: #bbb;
        cursor: not-allowed;
        background-color: rgba(255, 255, 255, 0.5);
    }
    
    .page-count {
        text-align: center;
        margin-bottom: 20px;
        color: #6c5ce7;
        font-size: 14px;
        background-color: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 10px;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        transition: transform 0.3s ease;
        border: 1px solid rgba(255, 182, 193, 0.5);
    }
    
    .page-count:hover {
        transform: scale(1.03);
    }
    
    /* 文章预览区域 */
    .post-preview {
        background-color: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        border: 1px solid rgba(255, 182, 193, 0.5);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
    }
    
    .post-preview:hover {
        transform: scale(1.03);
        box-shadow: 0 8px 20px rgba(255, 107, 151, 0.2);
    }
    
    /* 文章标题样式 */
    .post-preview .post-title {
        color: #6c5ce7;
        font-weight: bold;
        transition: color 0.3s ease;
    }
    
    .post-preview:hover .post-title {
        color: #ff6b97;
    }
    
    /* 文章副标题样式 */
    .post-preview .post-subtitle {
        color: #8a8a8a;
    }
    
    /* 文章内容预览 */
    .post-content-preview {
        color: #666;
        font-size: 15px;
        margin: 10px 0;
    }
    
    /* 文章预览装饰元素 */
    .post-preview::before {
        content: "✨";
        position: absolute;
        top: -5px;
        right: 20px;
        font-size: 20px;
        color: #ff6b97;
    }
    
    /* 文章元信息 */
    .post-meta {
        color: #a0a0a0;
        font-size: 13px;
        font-style: italic;
        border-top: 1px dashed rgba(255, 182, 193, 0.5);
        padding-top: 10px;
        margin-top: 15px;
    }
    
    /* 水平分割线样式 */
    hr {
        border: 0;
        height: 1px;
        background-image: linear-gradient(to right, rgba(255, 182, 193, 0), rgba(255, 182, 193, 0.75), rgba(255, 182, 193, 0));
        margin: 30px 0;
    }
    
    /* 移动设备适配 */
    @media (max-width: 768px) {
        .main-content-container,
        .post-preview,
        .pagination,
        .page-count {
            transform: none !important;
            transition: box-shadow 0.3s ease;
        }
        
        .main-content-container {
            padding: 15px;
            margin-top: 10px;
        }
        
        .post-preview {
            padding: 15px;
            margin-bottom: 15px;
        }
    }
    
    /* 动画效果 */
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-8px); }
        100% { transform: translateY(0px); }
    }
    
    .floating-element {
        animation: float 5s ease-in-out infinite;
    }
</style>

<!-- 主页内容容器 -->
<div class="main-content-container">
    <!-- 萌系装饰元素 -->
    <div style="position: absolute; top: -30px; right: 30px; font-size: 40px; transform: rotate(10deg);" class="floating-element">🌸</div>
    <div style="position: absolute; bottom: -25px; left: 50px; font-size: 35px; transform: rotate(-5deg);" class="floating-element">✨</div>
    
    <!-- 页面信息 -->
    <div class="page-count">
        {% if paginator.total_posts > 0 %}
        显示第 {{ paginator.page }}页 / 共{{ paginator.total_pages }}页 (总共{{ paginator.total_posts }}篇文章)
        {% endif %}
    </div>

    {% for post in paginator.posts %}
    <div class="post-preview">
        <a href="{{ post.url | prepend: site.baseurl }}">
            <h2 class="post-title">
                {{ post.title }}
            </h2>
            {% if post.subtitle %}
            <h3 class="post-subtitle">
                {{ post.subtitle }}
            </h3>
            {% endif %}
            <div class="post-content-preview">
                {% if post.lang == 'en' %}
                    {{ post.content | strip_html | truncate:300 }}
                {% else %}
                    {{ post.content | strip_html | truncate:200 }}
                {% endif %}
            </div>
        </a>
        <p class="post-meta">
            Posted by {% if post.author %}{{ post.author }}{% else %}{{ site.title }}{% endif %} on {{ post.date | date: "%B %-d, %Y" }}
        </p>
    </div>
    <hr>
    {% endfor %}

    <!-- 增强的分页导航 -->
    {% if paginator.total_pages > 1 %}
    <ul class="pagination">
        <!-- 首页链接 -->
        <li {% if paginator.page == 1 %}class="disabled"{% endif %}>
            {% if paginator.page == 1 %}
            <span>&laquo;&laquo;</span>
            {% else %}
            <a href="{{ '/index.html' | prepend: site.baseurl }}">&laquo;&laquo;</a>
            {% endif %}
        </li>

        <!-- 上一页链接 -->
        <li {% if paginator.previous_page == nil %}class="disabled"{% endif %}>
            {% if paginator.previous_page %}
            <a href="{{ paginator.previous_page_path | prepend: site.baseurl | replace: '//', '/' }}">&laquo;</a>
            {% else %}
            <span>&laquo;</span>
            {% endif %}
        </li>

        <!-- 页码链接 -->
        {% assign start_page = paginator.page | minus: 2 %}
        {% if start_page < 1 %}
            {% assign start_page = 1 %}
        {% endif %}
        
        {% assign end_page = start_page | plus: 4 %}
        {% if end_page > paginator.total_pages %}
            {% assign end_page = paginator.total_pages %}
            {% assign start_page = end_page | minus: 4 %}
            {% if start_page < 1 %}
                {% assign start_page = 1 %}
            {% endif %}
        {% endif %}
        
        {% for page in (start_page..end_page) %}
            <li {% if page == paginator.page %}class="active"{% endif %}>
                {% if page == paginator.page %}
                <span>{{ page }}</span>
                {% else %}
                    {% if page == 1 %}
                    <a href="{{ '/index.html' | prepend: site.baseurl }}">{{ page }}</a>
                    {% else %}
                    <a href="{{ site.paginate_path | prepend: site.baseurl | replace: '//', '/' | replace: ':num', page }}">{{ page }}</a>
                    {% endif %}
                {% endif %}
            </li>
        {% endfor %}

        <!-- 下一页链接 -->
        <li {% if paginator.next_page == nil %}class="disabled"{% endif %}>
            {% if paginator.next_page %}
            <a href="{{ paginator.next_page_path | prepend: site.baseurl | replace: '//', '/' }}">&raquo;</a>
            {% else %}
            <span>&raquo;</span>
            {% endif %}
        </li>

        <!-- 末页链接 -->
        <li {% if paginator.page == paginator.total_pages %}class="disabled"{% endif %}>
            {% if paginator.page == paginator.total_pages %}
            <span>&raquo;&raquo;</span>
            {% else %}
            <a href="{{ site.paginate_path | prepend: site.baseurl | replace: '//', '/' | replace: ':num', paginator.total_pages }}">&raquo;&raquo;</a>
            {% endif %}
        </li>
    </ul>
    {% endif %}
</div>

<!-- 添加几何图形背景脚本 -->
<script src="{{ '/js/geometry-background.js' | prepend: site.baseurl }}"></script>
<!-- 51la统计 -->
<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id:"3M1p9Hhnk53mxLF7",ck:"3M1p9Hhnk53mxLF7"})</script>

<!-- 页面内容缓存和自动更新脚本 -->
<script>
  // 全局内容缓存存储
  const pageCache = {
    // 缓存内容的数据结构
    contents: {},
    // 缓存时间戳
    timestamps: {},
    // 缓存有效期（毫秒）
    maxAge: 3600000, // 默认1小时
    // 移动端特殊标识
    isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
    // 记录已访问页面
    visitedPages: {},
    
    // 获取缓存键
    getKey: function(url) {
      // 去除URL中的刷新参数和时间戳
      return url.replace(/[?&]refresh=true/, '')
                .replace(/[?&]t=\d+/, '')
                .replace(/[?&]_=\d+/, '');
    },
    
    // 存储内容到缓存
    store: function(url, content) {
      const key = this.getKey(url);
      this.contents[key] = content;
      this.timestamps[key] = Date.now();
      
      // 同时保存到localStorage（如果可用）
      try {
        const cacheObject = {
          content: content,
          timestamp: this.timestamps[key]
        };
        localStorage.setItem(`page_cache_${key}`, JSON.stringify(cacheObject));
      } catch (e) {
        console.warn('无法将缓存写入localStorage', e);
      }
    },
    
    // 从缓存获取内容
    get: function(url) {
      const key = this.getKey(url);
      
      // 首先检查内存缓存
      if (this.contents[key] && this.timestamps[key]) {
        const age = Date.now() - this.timestamps[key];
        if (age < this.maxAge) {
          return this.contents[key];
        }
      }
      
      // 如果内存中没有有效缓存，检查localStorage
      try {
        const storedCache = localStorage.getItem(`page_cache_${key}`);
        if (storedCache) {
          const cacheObject = JSON.parse(storedCache);
          const age = Date.now() - cacheObject.timestamp;
          
          if (age < this.maxAge) {
            // 将缓存加载到内存中
            this.contents[key] = cacheObject.content;
            this.timestamps[key] = cacheObject.timestamp;
            return cacheObject.content;
          } else {
            // 清除过期缓存
            localStorage.removeItem(`page_cache_${key}`);
          }
        }
      } catch (e) {
        console.warn('无法从localStorage读取缓存', e);
      }
      
      return null;
    },
    
    // 清除特定URL的缓存
    clear: function(url) {
      const key = this.getKey(url);
      delete this.contents[key];
      delete this.timestamps[key];
      
      try {
        localStorage.removeItem(`page_cache_${key}`);
      } catch (e) {
        console.warn('无法从localStorage删除缓存', e);
      }
    },
    
    // 清除所有缓存
    clearAll: function() {
      this.contents = {};
      this.timestamps = {};
      
      try {
        // 只清除我们的缓存项，不影响其他localStorage数据
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith('page_cache_')) {
            localStorage.removeItem(key);
          }
        }
      } catch (e) {
        console.warn('无法清除localStorage缓存', e);
      }
    }
  };
  
  // 检查URL中是否有强制刷新参数
  function hasRefreshParam() {
    return window.location.href.indexOf('refresh=true') > -1;
  }
  
  // 检查URL中是否有禁止刷新参数
  function hasNoRefreshParam() {
    return window.location.href.indexOf('no-refresh=true') > -1;
  }
  
  // 预加载页面内容
  function preloadPageContent(url, callback) {
    // 移动端首页情况下，降低预加载优先级
    if (pageCache.isMobile && (url === '/' || url.indexOf('index.html') > -1)) {
      // 延迟执行，减轻加载压力
      setTimeout(() => {
        performPreload(url, callback);
      }, 2000); // 延迟2秒
    } else {
      performPreload(url, callback);
    }
  }
  
  // 执行实际预加载
  function performPreload(url, callback) {
    // 构建针对每个页面的缓存URL
    let cacheUrl = url;
    
    // 添加时间戳参数以避免缓存
    if (cacheUrl.indexOf('?') > -1) {
      cacheUrl += '&_=' + Date.now();
    } else {
      cacheUrl += '?_=' + Date.now();
    }
    
    fetch(cacheUrl, {
      method: 'GET',
      headers: {'X-Requested-With': 'XMLHttpRequest'},
      // 移动端降低优先级，减少对主线程的影响
      priority: pageCache.isMobile ? 'low' : 'auto'
    })
    .then(response => response.text())
    .then(html => {
      // 解析页面内容
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      
      // 获取主要内容部分
      const mainContent = doc.querySelector('.main-content-container');
      
      if (mainContent) {
        // 存储到缓存
        pageCache.store(url, mainContent.innerHTML);
        
        // 如果有回调函数，执行它
        if (callback && typeof callback === 'function') {
          callback(mainContent.innerHTML);
        }
      }
    })
    .catch(error => {
      console.warn('页面预加载失败:', error);
      // 如果有回调函数，仍然执行它，但传递null表示失败
      if (callback && typeof callback === 'function') {
        callback(null);
      }
    });
  }
  
  // 自动刷新页面内容
  function autoRefreshContent(forceRefresh = false) {
    // 如果是移动端首页，优化刷新策略
    const isHomePage = window.location.pathname === '/' || window.location.pathname === '/index.html';
    
    // 当前URL
    const currentUrl = pageCache.getKey(window.location.href);
    
    // 如果强制刷新，清除缓存
    if (forceRefresh) {
      pageCache.clear(currentUrl);
    }
    
    // 尝试从缓存获取内容
    const cachedContent = !forceRefresh ? pageCache.get(currentUrl) : null;
    
    if (cachedContent) {
      // 使用缓存的内容更新页面
      const currentPosts = document.querySelector('.main-content-container');
      if (currentPosts) {
        // 使用requestAnimationFrame优化DOM更新
        requestAnimationFrame(() => {
          currentPosts.innerHTML = cachedContent;
          
          // 预加载其他页面，移动端主页时减少或禁用预加载
          if (!(pageCache.isMobile && isHomePage)) {
            setTimeout(preloadOtherPages, 1000);
          }
        });
        
        return;
      }
    }
    
    // 如果没有可用的缓存，从服务器获取新内容
    const url = forceRefresh 
      ? window.location.href + (hasRefreshParam() ? '' : (window.location.href.indexOf('?') > -1 ? '&' : '?') + 'refresh=true&t=' + new Date().getTime())
      : window.location.href;
    
    fetch(url, {
      cache: forceRefresh ? 'no-cache' : 'default',
      headers: {'X-Requested-With': 'XMLHttpRequest'},
      // 移动端降低优先级
      priority: pageCache.isMobile ? 'low' : 'auto'
    })
    .then(response => response.text())
    .then(html => {
      // 解析返回的HTML
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      
      // 更新文章列表部分
      const newPosts = doc.querySelector('.main-content-container');
      const currentPosts = document.querySelector('.main-content-container');
      
      if (newPosts && currentPosts) {
        // 检查内容是否真的有变化或强制刷新
        if (forceRefresh || newPosts.innerHTML !== currentPosts.innerHTML) {
          // 只更新内容部分，不重载整个页面
          currentPosts.innerHTML = newPosts.innerHTML;
          
          // 将新内容存储到缓存
          pageCache.store(currentUrl, newPosts.innerHTML);
          
          // 预加载其他页面
          setTimeout(preloadOtherPages, 1000);
        }
      }
    })
    .catch(error => {
      console.error("刷新内容时发生错误:", error);
    });
  }
  
  // 预加载所有相关页面
  function preloadOtherPages() {
    // 移动端首页时，减少或禁用预加载
    if (pageCache.isMobile && (window.location.pathname === '/' || window.location.pathname === '/index.html')) {
      // 移动端首页时，只预加载下一页，减少资源消耗
      const nextPageLink = document.querySelector('.pagination .next a');
      if (nextPageLink && nextPageLink.href) {
        const nextPageUrl = pageCache.getKey(nextPageLink.href);
        if (!pageCache.get(nextPageUrl)) {
          preloadPageContent(nextPageUrl);
        }
      }
      return;
    }
    
    // 桌面端或非首页的常规预加载逻辑
    // 获取所有链接
    const links = document.querySelectorAll('a');
    const internalLinks = new Set();
    const baseUrl = '{{ site.baseurl }}';
    const domain = window.location.origin;
    
    // 收集所有内部链接
    links.forEach(link => {
      if (link.href && (link.href.startsWith(domain) || link.href.startsWith(baseUrl) || link.href.startsWith('/'))) {
        // 只处理相对路径内部链接和分页链接
        if (link.href.indexOf('/page/') > -1 || link.href.indexOf('index.html') > -1 || 
            link.href === domain + '/' || link.href === baseUrl + '/' || link.href === '/') {
          internalLinks.add(pageCache.getKey(link.href));
        }
      }
    });
    
    // 预加载所有内部链接（桌面最多5个，移动端最多2个，避免过多请求）
    let maxPreloads = pageCache.isMobile ? 2 : 5;
    let count = 0;
    for (const link of internalLinks) {
      if (count >= maxPreloads) break;
      
      // 只预加载尚未缓存的页面
      if (!pageCache.get(link)) {
        preloadPageContent(link);
        count++;
      }
    }
  }
  
  // 修改所有内部链接，优化点击体验
  function modifyInternalLinks() {
    const domain = window.location.origin;
    const baseUrl = '{{ site.baseurl }}';
    const links = document.querySelectorAll('a');
    
    links.forEach(link => {
      // 只处理内部链接
      if (link.href && (link.href.startsWith(domain) || link.href.startsWith(baseUrl) || link.href.startsWith('/'))) {
        // 标记链接已处理，防止重复添加事件
        if (link.getAttribute('data-enhanced') === 'true') {
          return;
        }
        link.setAttribute('data-enhanced', 'true');
        
        // 保存原始的点击事件
        const originalClick = link.onclick;
        
        // 添加新的点击事件处理
        link.onclick = function(e) {
          const targetUrl = pageCache.getKey(link.href);
          
          // 记录链接URL
          sessionStorage.setItem('lastClickUrl', targetUrl);
          
          // 检查是否已访问过该页面（有缓存）
          const cachedContent = pageCache.get(targetUrl);
          const isPageVisited = pageCache.visitedPages[targetUrl] === true;
          const isInternalPageLink = link.href.indexOf('/page/') > -1 || 
                                    link.href.indexOf('index.html') > -1 || 
                                    link.href === domain + '/' || 
                                    link.href === baseUrl + '/' || 
                                    link.href === '/';
          
          // 如果有缓存并且是内部页面链接
          if (cachedContent && isInternalPageLink) {
            // 阻止默认行为
            e.preventDefault();
            
            // 应用缓存内容
            const currentPosts = document.querySelector('.main-content-container');
            if (currentPosts) {
              // 使用requestAnimationFrame优化DOM更新
              requestAnimationFrame(() => {
                currentPosts.innerHTML = cachedContent;
                
                // 更新URL但不刷新页面
                if (window.history && window.history.pushState) {
                  window.history.pushState({
                    url: link.href,
                    cached: true
                  }, document.title, link.href);
                }
                
                // 标记不需要刷新
                sessionStorage.setItem('needsRefresh', 'false');
                
                // 记录已访问
                pageCache.visitedPages[targetUrl] = true;
                try {
                  localStorage.setItem('visitedPages', JSON.stringify(pageCache.visitedPages));
                } catch (e) {
                  console.warn('无法保存访问历史', e);
                }
              });
            }
            return false;
          }
          
          // 对于已访问过的页面，禁止刷新参数
          if (isPageVisited) {
            // 移除refresh参数，确保使用缓存
            let cleanHref = link.href.replace(/[?&]refresh=true/, '').replace(/[?&]t=\d+/, '');
            
            // 添加no-refresh标记
            const separator = cleanHref.indexOf('?') > -1 ? '&' : '?';
            link.href = cleanHref + separator + 'no-refresh=true';
            
            // 设置会话标志，表示不需要刷新
            sessionStorage.setItem('needsRefresh', 'false');
          } else if (link.href.indexOf('refresh=true') === -1 && link.href.indexOf('no-refresh=true') === -1) {
            // 对于首次访问的页面，添加刷新参数
            const separator = link.href.indexOf('?') > -1 ? '&' : '?';
            link.href = link.href + separator + 'refresh=true';
          }
          
          // 调用原始点击事件处理（如果有）
          if (originalClick) {
            return originalClick.call(this, e);
          }
        };
      }
    });
  }

  // 页面加载完成后立即执行初始化
  document.addEventListener('DOMContentLoaded', function() {
    // 移动端检测和优化
    const isMobile = pageCache.isMobile;
    const isHomePage = window.location.pathname === '/' || window.location.pathname === '/index.html';
    
    // 尝试从localStorage恢复访问历史
    try {
      const visitedPagesJson = localStorage.getItem('visitedPages');
      if (visitedPagesJson) {
        pageCache.visitedPages = JSON.parse(visitedPagesJson);
      }
    } catch (e) {
      console.warn('无法恢复访问历史', e);
      pageCache.visitedPages = {};
    }
    
    // 检查本地缓存，确保首次加载能从缓存获取
    const currentUrl = pageCache.getKey(window.location.href);
    let cachedContent = pageCache.get(currentUrl);
    
    // 标记当前页面已访问
    pageCache.visitedPages[currentUrl] = true;
    try {
      localStorage.setItem('visitedPages', JSON.stringify(pageCache.visitedPages));
    } catch (e) {
      console.warn('无法保存访问历史', e);
    }
    
    // 如果找到有效缓存，立即使用它
    if (cachedContent) {
      const contentContainer = document.querySelector('.main-content-container');
      if (contentContainer) {
        // 使用requestAnimationFrame优化DOM更新
        requestAnimationFrame(() => {
          contentContainer.innerHTML = cachedContent;
        });
      }
    }
    
    // 检查是否需要强制刷新（来自其他页面跳转）
    const needsForceRefresh = hasRefreshParam() || (sessionStorage.getItem('needsRefresh') === 'true' && !hasNoRefreshParam());
    
    // 检查是否是从内部页面返回主页
    const isReturningToHomePage = isHomePage && 
                                 sessionStorage.getItem('lastVisitedPage') && 
                                 sessionStorage.getItem('homePageCacheApplied') === 'true';
    
    // 检查是否是已访问过的页面
    const isVisitedPage = pageCache.visitedPages[currentUrl] === true && !hasRefreshParam();
    
    // 只有在需要刷新的情况下才执行刷新
    if (!isReturningToHomePage && !isVisitedPage) {
      // 执行刷新
      autoRefreshContent(needsForceRefresh);
    } else {
      console.log('使用缓存内容，不刷新');
      
      // 从URL中移除刷新参数
      if ((hasRefreshParam() || hasNoRefreshParam()) && window.history && window.history.replaceState) {
        const cleanUrl = window.location.href
          .replace(/[?&]refresh=true/, '')
          .replace(/[?&]no-refresh=true/, '')
          .replace(/[?&]t=\d+/, '');
        window.history.replaceState({}, document.title, cleanUrl);
      }
    }
    
    // 重置刷新标志
    sessionStorage.setItem('needsRefresh', 'false');
    
    // 修改所有内部链接
    modifyInternalLinks();
    
    // 监听页面可见性变化（当用户从其他标签页回到此页面时）
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'visible') {
        // 用户回到页面，检查缓存是否仍然有效
        if (pageCache.get(currentUrl)) {
          // 如果缓存有效，检查更新但不强制刷新
          autoRefreshContent(false);
        } else {
          // 如果缓存过期，执行强制刷新
          autoRefreshContent(true);
        }
      }
    });
    
    // 监听浏览器前进/后退事件
    window.addEventListener('popstate', function(event) {
      // 获取历史状态
      const state = event.state || {};
      
      // 获取当前URL的缓存内容
      const newUrl = pageCache.getKey(window.location.href);
      const cacheContent = pageCache.get(newUrl);
      
      // 如果有缓存，或者状态标记为已缓存
      if (cacheContent || state.cached) {
        // 应用缓存内容而不重新加载
        const contentContainer = document.querySelector('.main-content-container');
        if (contentContainer) {
          // 使用requestAnimationFrame优化DOM更新
          requestAnimationFrame(() => {
            contentContainer.innerHTML = cacheContent;
          });
        }
      } else {
        // 如果没有缓存，刷新当前页面
        autoRefreshContent(true);
      }
    });
    
    // 之后每隔一段时间检查一次更新，移动端降低频率
    const refreshInterval = isMobile ? 120000 : 60000; // 移动端2分钟，桌面端1分钟
    setInterval(() => autoRefreshContent(false), refreshInterval);
  });
  
  // 用户离开当前页面时，设置刷新标志
  window.addEventListener('beforeunload', function(e) {
    // 只有在非主页时才设置刷新标志
    if (!(window.location.pathname === '/' || window.location.pathname === '/index.html')) {
      // 将当前页面标记为最后访问的页面
      const currentUrl = pageCache.getKey(window.location.href);
      sessionStorage.setItem('lastVisitedPage', currentUrl);
      sessionStorage.setItem('needsRefresh', 'true');
    } else {
      // 在主页面时，不设置刷新标志，保持缓存
      sessionStorage.setItem('needsRefresh', 'false');
    }
  });
</script>

<!-- 添加主页面缓存优化脚本 -->
<script>
// 主页特殊缓存处理
(function() {
  // 保存音乐播放器状态到localStorage，使其在刷新后保持
  try {
    // 获取播放器状态
    const musicPlayerSrc = sessionStorage.getItem('musicPlayerSrc') || '';
    const musicPlayerInitialized = sessionStorage.getItem('musicPlayerInitialized') || 'false';
    
    // 保存到localStorage以在刷新后恢复
    if (musicPlayerInitialized === 'true' && musicPlayerSrc) {
      localStorage.setItem('musicPlayerSrc', musicPlayerSrc);
      localStorage.setItem('musicPlayerInitialized', 'true');
    }
    
    // 从localStorage恢复到sessionStorage（刷新后）
    if (!sessionStorage.getItem('musicPlayerSrc') && localStorage.getItem('musicPlayerSrc')) {
      sessionStorage.setItem('musicPlayerSrc', localStorage.getItem('musicPlayerSrc'));
      sessionStorage.setItem('musicPlayerInitialized', localStorage.getItem('musicPlayerInitialized') || 'false');
    }
  } catch (e) {
    console.warn('保存/恢复音乐播放器状态失败', e);
  }
  
  const isHomePage = window.location.pathname === '/' || window.location.pathname === '/index.html';
  const lastPage = sessionStorage.getItem('lastVisitedPage') || '';
  const cameFromInternalPage = lastPage.includes(window.location.hostname) || lastPage.startsWith('/');
  
  // 如果是主页且是从内部页面返回的，使用缓存版本
  if (isHomePage && cameFromInternalPage) {
    // 标记已经处理过，避免重复处理
    sessionStorage.setItem('homePageCacheApplied', 'true');
    
    // 使用Performance API检测导航类型
    if (window.performance && performance.navigation) {
      if (performance.navigation.type === 2) { // 2表示通过后退/前进按钮导航
        console.log('通过后退/前进返回主页，保持缓存内容');
        // 阻止页面重新加载
        sessionStorage.setItem('needsRefresh', 'false');
        
        // 直接从缓存获取内容
        const currentUrl = window.location.href.split('?')[0]; // 不含参数的URL
        try {
          // 检查是否有本地缓存
          const cachedContent = pageCache.get(currentUrl);
          if (cachedContent) {
            const contentContainer = document.querySelector('.main-content-container');
            if (contentContainer) {
              // 应用缓存内容
              contentContainer.innerHTML = cachedContent;
              console.log('已应用本地缓存的主页内容');
            }
          }
        } catch (e) {
          console.warn('应用缓存内容时出错:', e);
        }
      }
    }
    
    // 从浏览器缓存中获取主页
    if ('caches' in window) {
      caches.open('homepage-cache').then(cache => {
        const homepageUrl = window.location.href.split('?')[0]; // 不含参数的URL
        cache.match(homepageUrl).then(response => {
          if (response) {
            console.log('主页已存在于浏览器缓存中');
          } else {
            // 如果不存在则添加
            cache.add(homepageUrl).then(() => {
              console.log('主页已添加到浏览器缓存');
            });
          }
        });
      }).catch(err => {
        console.warn('缓存操作失败:', err);
      });
    }
  } else if (isHomePage) {
    // 首次加载主页，存储到浏览器缓存
    sessionStorage.removeItem('homePageCacheApplied');
    if ('caches' in window) {
      const homepageUrl = window.location.href.split('?')[0]; // 不含参数的URL
      caches.open('homepage-cache').then(cache => {
        // 先检查缓存中是否存在
        cache.match(homepageUrl).then(response => {
          if (!response) {
            // 不存在则添加
            cache.add(homepageUrl).then(() => {
              console.log('主页首次添加到浏览器缓存');
            });
          } else {
            // 存在则更新
            cache.delete(homepageUrl).then(() => {
              cache.add(homepageUrl).then(() => {
                console.log('主页缓存已更新');
              });
            });
          }
        });
      }).catch(err => {
        console.warn('初始缓存操作失败:', err);
      });
    }
    
    // 同时保存到本地缓存系统
    const currentUrl = pageCache.getKey(window.location.href);
    const mainContent = document.querySelector('.main-content-container');
    if (mainContent) {
      pageCache.store(currentUrl, mainContent.innerHTML);
      console.log('主页内容已保存到本地缓存');
    }
  }
})();
</script>

<!-- 简单脚本：减少主页内容与背景之间的空白 -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 我们仅在首页做这些调整
    if (window.location.pathname === '/' || window.location.pathname === '/index.html') {
      // 确保内容容器直接跟随在背景图片后面
      var contentContainer = document.querySelector('.main-content-container');
      if (contentContainer) {
        // 直接对容器应用样式，不添加任何新元素
        contentContainer.style.marginTop = '-2px'; // 微小的负边距消除空隙
      }
      
      // 移动端滚动性能优化
      if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        // 对页面添加平滑滚动样式
        document.body.style.cssText += '-webkit-overflow-scrolling: touch;';
        
        // 设置主内容容器GPU加速
        if (contentContainer) {
          contentContainer.style.transform = 'translateZ(0)';
          contentContainer.style.willChange = 'transform';
        }
        
        // 减少移动端可能出现的闪烁问题
        var styleElement = document.createElement('style');
        styleElement.textContent = `
          /* 移动端优化 */
          body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: auto !important;
            overflow: auto !important;
          }
          
          /* 使用更高性能的动画属性 */
          .post-preview, .pagination, .music-player-container {
            will-change: transform;
            transform: translateZ(0);
          }
          
          /* 优化滚动容器 */
          .main-content-container {
            -webkit-overflow-scrolling: touch;
            overflow-y: auto !important;
            overscroll-behavior-y: auto;
            height: auto !important;
            touch-action: auto !important;
            position: relative;
            z-index: 10;
          }
          
          /* 减少hover状态引起的重绘 */
          @media (max-width: 767px) {
            a:hover {
              transition: none !important;
            }
            
            /* 减少图形背景对移动端滚动性能的影响 */
            #geometry-background {
              will-change: transform;
              transform: translateZ(0);
              opacity: 0.8; /* 稍微降低透明度，减轻渲染压力 */
              pointer-events: none;
              z-index: 1;
            }
            
            html, body {
              overflow: auto !important;
              height: auto !important;
              position: relative !important;
              touch-action: auto !important;
            }
          }
        `;
        document.head.appendChild(styleElement);
        
        // 移除可能导致滚动问题的设置
        document.documentElement.style.overscrollBehavior = 'auto';
        document.body.style.overflow = 'auto';
        document.body.style.height = 'auto';
        document.documentElement.style.overflow = 'auto';
        document.documentElement.style.height = 'auto';
        
        // 处理触摸相关事件，确保允许滚动
        document.addEventListener('touchmove', function(e) {
          // 不阻止任何默认滚动行为
        }, { passive: true });
        
        // 修复100ms后再次检查滚动问题
        setTimeout(function() {
          // 确保滚动容器可以滚动
          var contentContainer = document.querySelector('.main-content-container');
          if (contentContainer) {
            contentContainer.style.overflow = 'auto';
            contentContainer.style.touchAction = 'auto';
          }
          
          // 重置文档滚动设置
          document.documentElement.style.overflow = 'auto';
          document.body.style.overflow = 'auto';
          
          // 确保背景不会阻止触摸事件
          var bgElement = document.getElementById('geometry-background');
          if (bgElement) {
            bgElement.style.pointerEvents = 'none';
          }
        }, 100);
      }
    }
  });
</script>

<!-- 添加二次元装饰元素的动画效果 -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // 创建浮动装饰元素
  const createFloatingElements = () => {
    const decorElements = ['🌟', '💖', '🎀', '✨', '🌸', '🐰', '🍭'];
    const container = document.querySelector('.main-content-container');
    
    if (!container) return;
    
    // 创建5-8个随机装饰元素
    const elemCount = Math.floor(Math.random() * 4) + 5;
    
    for (let i = 0; i < elemCount; i++) {
      const elem = document.createElement('div');
      const randomEmoji = decorElements[Math.floor(Math.random() * decorElements.length)];
      elem.textContent = randomEmoji;
      elem.style.position = 'absolute';
      elem.style.fontSize = (Math.random() * 15 + 15) + 'px';
      elem.style.opacity = (Math.random() * 0.4 + 0.6).toString();
      elem.style.color = '#' + Math.floor(Math.random()*16777215).toString(16);
      
      // 随机位置（容器外围）
      const isTop = Math.random() > 0.5;
      const isLeft = Math.random() > 0.5;
      
      if (isTop) {
        elem.style.top = (Math.random() * 40 - 50) + 'px';
      } else {
        elem.style.bottom = (Math.random() * 40 - 50) + 'px';
      }
      
      if (isLeft) {
        elem.style.left = (Math.random() * (container.offsetWidth - 30)) + 'px';
      } else {
        elem.style.right = (Math.random() * (container.offsetWidth - 30)) + 'px';
      }
      
      // 旋转角度
      elem.style.transform = `rotate(${Math.random() * 40 - 20}deg)`;
      
      // 添加浮动动画，但每个动画时长和延迟略有差异
      elem.style.animation = `float ${Math.random() * 2 + 4}s ease-in-out ${Math.random() * 2}s infinite`;
      
      // 添加到容器
      container.appendChild(elem);
    }
  };
  
  // 在非移动设备才添加装饰元素（避免移动设备性能问题）
  if (!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
    createFloatingElements();
  }
  
  // 鼠标经过文章时添加闪光效果
  const posts = document.querySelectorAll('.post-preview');
  posts.forEach(post => {
    post.addEventListener('mouseenter', function() {
      const sparkle = document.createElement('div');
      sparkle.innerHTML = '✨';
      sparkle.style.position = 'absolute';
      sparkle.style.top = '-10px';
      sparkle.style.left = '20px';
      sparkle.style.fontSize = '20px';
      sparkle.style.opacity = '0';
      sparkle.style.transition = 'all 0.5s ease';
      
      post.appendChild(sparkle);
      
      // 淡入效果
      setTimeout(() => {
        sparkle.style.opacity = '1';
        sparkle.style.transform = 'translateY(-10px) scale(1.2)';
      }, 10);
      
      // 淡出效果
      setTimeout(() => {
        sparkle.style.opacity = '0';
        setTimeout(() => {
          sparkle.remove();
        }, 500);
      }, 1000);
    });
  });
});
</script>
