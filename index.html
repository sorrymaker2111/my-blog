---
layout: page
description: "「组一辈子乐队吧！」"
---

<!-- 添加几何图形背景CSS -->
<link rel="stylesheet" href="{{ '/css/geometry-background.css' | prepend: site.baseurl }}">

<!-- 自动刷新内容设置 -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">

<!-- 添加分页导航样式 -->
<style>
    /* 主页内容的容器 */
    .main-content-container {
        background-color: #fff;
        padding-top: 30px;
        position: relative;
        z-index: 2;
    }
    
    /* 为了让主页全屏效果更好的样式 */
    .home-spacer {
        height: 0; /* 原来是100vh，改为0，去除空白 */
        width: 100%;
        display: none; /* 隐藏占位符 */
    }
    
    .pagination {
        display: flex;
        justify-content: center;
        margin: 30px 0;
        padding: 0;
        list-style: none;
    }
    
    .pagination li {
        margin: 0 5px;
    }
    
    .pagination li a,
    .pagination li span {
        display: block;
        padding: 8px 16px;
        border: 1px solid #ddd;
        color: #555;
        text-decoration: none;
        border-radius: 4px;
        transition: all 0.3s ease;
    }
    
    .pagination li a:hover {
        background-color: #f5f5f5;
        color: #333;
    }
    
    .pagination li.active span {
        background-color: #337ab7;
        color: white;
        border-color: #337ab7;
    }
    
    .pagination li.disabled span {
        color: #bbb;
        cursor: not-allowed;
    }
    
    .page-count {
        text-align: center;
        margin-bottom: 20px;
        color: #777;
        font-size: 14px;
    }
    
    /* 音乐播放器样式 */
    .music-player-container {
        position: relative; 
        width: 100%; 
        max-width: 730px; 
        margin: 0 auto;
    }
    
    .music-player-wrapper {
        position: relative; 
        overflow: hidden;
    }
    
    .music-player-wrapper.pc {
        padding-top: 56.25%; /* 16:9 比例 */
    }
    
    .music-player-wrapper.mobile {
        padding-top: 133.33%; /* 3:4 比例，更高的播放器适合移动端 */
    }
    
    .music-player-iframe {
        position: absolute; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%;
    }
</style>

<!-- 主页内容容器 - 不再需要全屏占位符 -->
<div class="main-content-container">
    {% if paginator.page == 1 %}
    <div class="music-player-title">
        <h4>我喜欢的歌单</h4>
    </div>

    <div class="music-player-container">
        <div id="musicPlayerWrapper" class="music-player-wrapper pc">
            <iframe id="musicPlayerIframe" frameborder="no" border="0" marginwidth="0" marginheight="0" 
                class="music-player-iframe" 
                src="https://music.163.com/outchain/player?type=0&id=13052360489&auto=0&height=430"></iframe>
        </div>
    </div>

    <script>
        // 检测设备类型
        function isMobileDevice() {
            return (window.innerWidth <= 768) || 
                (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
        }
        
        // 调整播放器
        function adjustMusicPlayer() {
            var wrapper = document.getElementById('musicPlayerWrapper');
            var iframe = document.getElementById('musicPlayerIframe');
            
            if (isMobileDevice()) {
                wrapper.className = 'music-player-wrapper mobile';
                // 移动端使用/m/前缀的播放器
                if (iframe.src.indexOf('/m/outchain') === -1) {
                    iframe.src = iframe.src.replace('/outchain', '/m/outchain');
                }
            } else {
                wrapper.className = 'music-player-wrapper pc';
                // PC端使用普通播放器
                iframe.src = iframe.src.replace('/m/outchain', '/outchain');
            }
        }
        
        // 页面加载和窗口大小改变时调整
        window.addEventListener('load', adjustMusicPlayer);
        window.addEventListener('resize', adjustMusicPlayer);
    </script>
    {% endif %}

    <!-- 页面信息 -->
    <div class="page-count">
        {% if paginator.total_posts > 0 %}
        显示第 {{ paginator.page }}页 / 共{{ paginator.total_pages }}页 (总共{{ paginator.total_posts }}篇文章)
        {% endif %}
    </div>

    {% for post in paginator.posts %}
    <div class="post-preview">
        <a href="{{ post.url | prepend: site.baseurl }}">
            <h2 class="post-title">
                {{ post.title }}
            </h2>
            {% if post.subtitle %}
            <h3 class="post-subtitle">
                {{ post.subtitle }}
            </h3>
            {% endif %}
            <div class="post-content-preview">
                {% if post.lang == 'en' %}
                    {{ post.content | strip_html | truncate:300 }}
                {% else %}
                    {{ post.content | strip_html | truncate:200 }}
                {% endif %}
            </div>
        </a>
        <p class="post-meta">
            Posted by {% if post.author %}{{ post.author }}{% else %}{{ site.title }}{% endif %} on {{ post.date | date: "%B %-d, %Y" }}
        </p>
    </div>
    <hr>
    {% endfor %}

    <!-- 增强的分页导航 -->
    {% if paginator.total_pages > 1 %}
    <ul class="pagination">
        <!-- 首页链接 -->
        <li {% if paginator.page == 1 %}class="disabled"{% endif %}>
            {% if paginator.page == 1 %}
            <span>&laquo;&laquo;</span>
            {% else %}
            <a href="{{ '/index.html' | prepend: site.baseurl }}">&laquo;&laquo;</a>
            {% endif %}
        </li>

        <!-- 上一页链接 -->
        <li {% if paginator.previous_page == nil %}class="disabled"{% endif %}>
            {% if paginator.previous_page %}
            <a href="{{ paginator.previous_page_path | prepend: site.baseurl | replace: '//', '/' }}">&laquo;</a>
            {% else %}
            <span>&laquo;</span>
            {% endif %}
        </li>

        <!-- 页码链接 -->
        {% assign start_page = paginator.page | minus: 2 %}
        {% if start_page < 1 %}
            {% assign start_page = 1 %}
        {% endif %}
        
        {% assign end_page = start_page | plus: 4 %}
        {% if end_page > paginator.total_pages %}
            {% assign end_page = paginator.total_pages %}
            {% assign start_page = end_page | minus: 4 %}
            {% if start_page < 1 %}
                {% assign start_page = 1 %}
            {% endif %}
        {% endif %}
        
        {% for page in (start_page..end_page) %}
            <li {% if page == paginator.page %}class="active"{% endif %}>
                {% if page == paginator.page %}
                <span>{{ page }}</span>
                {% else %}
                    {% if page == 1 %}
                    <a href="{{ '/index.html' | prepend: site.baseurl }}">{{ page }}</a>
                    {% else %}
                    <a href="{{ site.paginate_path | prepend: site.baseurl | replace: '//', '/' | replace: ':num', page }}">{{ page }}</a>
                    {% endif %}
                {% endif %}
            </li>
        {% endfor %}

        <!-- 下一页链接 -->
        <li {% if paginator.next_page == nil %}class="disabled"{% endif %}>
            {% if paginator.next_page %}
            <a href="{{ paginator.next_page_path | prepend: site.baseurl | replace: '//', '/' }}">&raquo;</a>
            {% else %}
            <span>&raquo;</span>
            {% endif %}
        </li>

        <!-- 末页链接 -->
        <li {% if paginator.page == paginator.total_pages %}class="disabled"{% endif %}>
            {% if paginator.page == paginator.total_pages %}
            <span>&raquo;&raquo;</span>
            {% else %}
            <a href="{{ site.paginate_path | prepend: site.baseurl | replace: '//', '/' | replace: ':num', paginator.total_pages }}">&raquo;&raquo;</a>
            {% endif %}
        </li>
    </ul>
    {% endif %}
</div>

<!-- 添加几何图形背景脚本 -->
<script src="{{ '/js/geometry-background.js' | prepend: site.baseurl }}"></script>
<!-- 51la统计 -->
<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id:"3M1p9Hhnk53mxLF7",ck:"3M1p9Hhnk53mxLF7"})</script>

<!-- 自动更新内容脚本 -->
<script>
  // 检查URL中是否有强制刷新参数
  function hasRefreshParam() {
    return window.location.href.indexOf('refresh=true') > -1;
  }
  
  // 自动刷新页面内容
  function autoRefreshContent(forceRefresh = false) {
    // 检查是否有新内容可用，如果是强制刷新则添加时间戳参数避免缓存
    const url = forceRefresh 
      ? window.location.href + (hasRefreshParam() ? '' : (window.location.href.indexOf('?') > -1 ? '&' : '?') + 'refresh=true&t=' + new Date().getTime())
      : window.location.href;
    
    fetch(url, {
      cache: forceRefresh ? 'no-cache' : 'no-store',
      headers: {'X-Requested-With': 'XMLHttpRequest'}
    })
    .then(response => response.text())
    .then(html => {
      // 解析返回的HTML
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');
      
      // 更新文章列表部分
      const newPosts = doc.querySelector('.main-content-container');
      const currentPosts = document.querySelector('.main-content-container');
      
      if (newPosts && currentPosts) {
        // 检查内容是否真的有变化或强制刷新
        if (forceRefresh || newPosts.innerHTML !== currentPosts.innerHTML) {
          // 只更新内容部分，不重载整个页面
          currentPosts.innerHTML = newPosts.innerHTML;
          
          // 重新初始化音乐播放器（如果存在）
          if (typeof adjustMusicPlayer === 'function') {
            setTimeout(adjustMusicPlayer, 100);
          }
          
          // 移除URL中的刷新参数
          if (hasRefreshParam() && window.history && window.history.replaceState) {
            const cleanUrl = window.location.href.replace(/[?&]refresh=true/, '').replace(/[?&]t=\d+/, '');
            window.history.replaceState({}, document.title, cleanUrl);
          }
        }
      }
    })
    .catch(error => {
      // 静默处理错误，不在控制台显示
      console.error("刷新内容时发生错误:", error);
    });
  }
  
  // 修改所有内部链接，添加刷新参数
  function modifyInternalLinks() {
    const domain = window.location.origin;
    const baseUrl = '{{ site.baseurl }}';
    const links = document.querySelectorAll('a');
    
    links.forEach(link => {
      // 只处理内部链接
      if (link.href && (link.href.startsWith(domain) || link.href.startsWith(baseUrl) || link.href.startsWith('/'))) {
        // 保存原始的点击事件
        const originalClick = link.onclick;
        
        // 添加新的点击事件处理
        link.onclick = function(e) {
          // 如果链接已经包含refresh参数，则不再添加
          if (link.href.indexOf('refresh=true') === -1) {
            // 确定正确的分隔符
            const separator = link.href.indexOf('?') > -1 ? '&' : '?';
            // 修改链接，添加刷新参数
            link.href = link.href + separator + 'refresh=true';
          }
          
          // 调用原始的点击事件处理（如果有）
          if (originalClick) {
            return originalClick.call(this, e);
          }
        };
      }
    });
  }

  // 页面加载完成后立即执行初始化
  document.addEventListener('DOMContentLoaded', function() {
    // 检查是否需要强制刷新（来自其他页面跳转）
    const needsForceRefresh = hasRefreshParam() || sessionStorage.getItem('needsRefresh') === 'true';
    
    // 立即执行一次刷新，如果需要则强制刷新
    autoRefreshContent(needsForceRefresh);
    
    // 重置刷新标志
    sessionStorage.setItem('needsRefresh', 'false');
    
    // 修改所有内部链接
    modifyInternalLinks();
    
    // 监听页面可见性变化（当用户从其他标签页回到此页面时）
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'visible') {
        // 用户回到页面，执行刷新
        autoRefreshContent(true);
      }
    });
    
    // 之后每60秒检查一次
    setInterval(() => autoRefreshContent(false), 60000);
  });
  
  // 用户离开当前页面时，设置刷新标志
  window.addEventListener('beforeunload', function() {
    sessionStorage.setItem('needsRefresh', 'true');
  });
</script>

<!-- 简单脚本：减少主页内容与背景之间的空白 -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // 我们仅在首页做这些调整
    if (window.location.pathname === '/' || window.location.pathname === '/index.html') {
      // 确保内容容器直接跟随在背景图片后面
      var contentContainer = document.querySelector('.main-content-container');
      if (contentContainer) {
        // 直接对容器应用样式，不添加任何新元素
        contentContainer.style.marginTop = '-2px'; // 微小的负边距消除空隙
      }
    }
  });
</script>
